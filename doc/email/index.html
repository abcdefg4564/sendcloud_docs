<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="canonical" href="http://sendcloud.sohu.com/email/"> 
    <link rel="shortcut icon" href="../favicon.ico">
    <title>规则 - SendCloud 文档中心</title>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    
</head>
<body>
    <div class="navbar navbar-default" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://sendcloud.sohu.com">SendCloud 文档中心</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                
                  <li class="pull-left">
                    
                    <a href="..">文档首页</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="../guide/base/">开发者指南</a>
                    
                  </li>
                
                  <li class="pull-left active">
                    
                    <a href="./">邮件API</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="../sms/">短信API</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="../downloads/">代码示例</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="../faq/">FAQ</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="../test/">测试平台</a>
                    
                  </li>
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <!-- <ul class="nav navbar-nav navbar-right">
                
                
                
                <li>
                    <a href="https://github.com/sendcloud2013/sendcloud_docs/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul> -->
            
        </div>
    </div>
</div>
    <div class="container main">
         <div class="toolbar clearfix">
  <ol class="breadcrumb pull-left">
    <li><a href="..">文档</a></li>
    <li>规则</li>
  </ol>

  
    
      <a href="https://github.com/sendcloud2013/sendcloud_docs/" class="github-edit pull-right"><i class="fa fa-github"></i> Edit on GitHub</a>
    
  

</div>
        <div class="col-md-3"><div class="bs-sidebar hidden-print" data-spy="affix" data-offset-top="80" role="complementary">
    <ul class="nav bs-sidenav">
     
      
        
      

    
      
        
      

    
      
        
          

              <li class="active">
                <a class="itm-l1" href="./">规则</a>
                
                  <ul class="nav">
                  
                    <li class="active "><a href="#webapi">WEBAPI 的请求格式</a></li>
                    
                  
                    <li class=""><a href="#webapi_1">WEBAPI 的响应格式</a></li>
                    
                  
                    <li class=""><a href="#smtp">SMTP 请求方式</a></li>
                    
                  
                    <li class=""><a href="#messageid-emailid">messageId 和 emailId</a></li>
                    
                  
                    <li class=""><a href="#_1">变量替换</a></li>
                    
                  
                    <li class=""><a href="#x-smtpapi">X-SMTPAPI 扩展字段</a></li>
                    
                  
                  </ul>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="send_email/">邮件发送</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="template_do/">邮件模板</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="list_do/">地址列表</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="label_do/">邮件标签</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="queuestatus_do/">队列状态</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="stats_do/">数据统计</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="user_info/">用户信息</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="bounce_do/">退信列表管理</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="unsubscribe_do/">取消订阅管理</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="spamreported_do/">垃圾举报管理</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="webhook/">WebHook 详细</a>
                
              </li>

          
        
      

    
      
        
      

    
      
        
      

    
      
        
      

    
      
        
      

    
    </ul>
</div></div>
        <div class="col-md-9 content-body" role="main">
             

<h1>规则</h1>

<h2 id="webapi">WEBAPI 的请求格式</h2>
<p><code>http://sendcloud.sohu.com/webapi/&lt;模块&gt;.&lt;动作&gt;.&lt;格式&gt;</code></p>
<p>模块: 功能模块名称.  比如: mail (邮件模块), list (地址列表) 等.</p>
<p>动作: 每个模块所实现的功能. 比如: send, create 等.</p>
<p>格式: 返回的数据格式, 可以是 JSON 或者 XML 格式. ( 本文档按照 JSON 格式进行说明, XML 格式可自行脑补 )</p>
<pre><code> /mail.send.json  # 邮件发送, 返回 JSON
 /list.create.xml # 地址列表创建, 返回 XML
</code></pre>
<p><strong>提示</strong>: 所有的 WEBAPI 都支持 HTTPS. </p>
<hr />
<h2 id="webapi_1">WEBAPI 的响应格式</h2>
<p>服务器根据 WEBAPI 请求时的格式, 来确定响应数据的格式. 如果请求时没有指定返回格式, API 会报错. </p>
<p>WEBAPI 返回的信息, 示例如下: </p>
<pre><code>    # 请求成功
    {
        &quot;message&quot;: &quot;success&quot;,
        ...
    }

    # 请求失败
    {
        &quot;message&quot;: &quot;error&quot;,
        &quot;errors&quot;: {},
    }
</code></pre>

<hr />
<h2 id="smtp">SMTP 请求方式</h2>
<p>为开发者提供 SMTP 协议的投递方式, 以下是会话过程. 详细的代码示例, 请移步<a href="../downloads/code/python/#smtp">这里</a></p>
<pre><code>S: 220 SendCloud Inbound Server ESMTP Haraka 2.2.4 ready

C: ehlo ifaxin.com

S: 250-SendCloud Inbound Server Hello, Haraka is at your service.
S: 250-PIPELINING
S: 250-8BITMIME
S: 250-SIZE 16000000
S: 250 AUTH LOGIN

C: AUTH LOGIN base64(api_user)

S: 334 UGFzc3dvcmQ6

C: base64(api_key)

S: 235 Authentication successful

C: mail FROM:&lt;support@ifaxin.com&gt;

S: 250 sender &lt;support@ifaxin.com&gt; OK

C: rcpt TO:&lt;ben@ifaxin.com&gt;

S: 250 recipient &lt;ben@ifaxin.com&gt; OK

C: data

S: 354 go ahead, make my day

C: ... ...
C: .

S: 250 #1426390015358_15_6484_8661.sc-10_10_127_51-inbound#Queued

C: quit

S: 221 SendCloud Inbound Server closing connection. Have a jolly good day
</code></pre>

<hr />
<h2 id="messageid-emailid">messageId 和 emailId</h2>
<p><code>messageId</code> 是提交一次请求, 返回的消息编号.</p>
<p><code>emailId</code> 是 SendCloud 投递一封邮件, 返回的邮件编号, 可以对应到某一次请求的某一个收件人.</p>
<p>两者的计算关系如下:</p>
<pre><code>to = [A, B, C]
emailId_A = messageId + to.index(A) + '$' + A
emailId_B = messageId + to.index(B) + '$' + B
emailId_C = messageId + to.index(C) + '$' + C

# 注意: position 不做位数补齐
</code></pre>

<p>举例如下: </p>
<pre><code># to = [&quot;ben@ifaxin.com&quot;, &quot;joe@ifaxin.com&quot;, &quot;bida@ifaxin.com&quot;, ... , &quot;lianzimi@ifaxin.com&quot;]
1425758592214_4576_32113_9310.sc-10_10_127_105-inbound  # messageId
1425758592214_4576_32113_9310.sc-10_10_127_105-inbound0$ben@ifaxin.com  # emailId
1425758592214_4576_32113_9310.sc-10_10_127_105-inbound1$joe@ifaxin.com  # emailId
1425758592214_4576_32113_9310.sc-10_10_127_105-inbound2$bida@ifaxin.com  # emailId
...
1425758592214_4576_32113_9310.sc-10_10_127_105-inbound99$lianzimi@ifaxin.com  # emailId
</code></pre>

<hr />
<h2 id="_1">变量替换</h2>
<p>SendCloud 支持在邮件中使用「变量」. </p>
<p>变量的格式: 首尾使用 <code>%</code> 包含, 即为用户定义的一个变量. 举例:</p>
<pre><code>亲爱的%name%: # name是变量

    欢迎注册爱发信, 这是您的验证码: %active_code%. # active_code是变量
</code></pre>

<p>变量的用法:</p>
<ol>
<li>在 <em>普通发送</em>, <em>模板发送</em> 中使用变量, 来作为占位符</li>
<li>在 <em>地址列表</em>, <em>X-SMTPAPI</em> 中设置变量的值</li>
<li>SendCloud 会根据不同收件人, 来替换邮件内容中相应变量的值</li>
</ol>
<p><strong>注意</strong>: 邮件标题中的变量不会被替换, 所以不要在标题中设置变量</p>
<hr />
<h2 id="x-smtpapi">X-SMTPAPI 扩展字段</h2>
<p>X-SMTPAPI 是 SendCloud 为开发者提供的邮件个性化定制的处理方式, 开发者通过这个特殊的 <strong>信头扩展字段</strong>, 可以设置邮件处理方式的很多参数.  一般的, 开发者在使用 SMTP 接入时会使用此字段. 不过, WEBAPI 的方式也支持此参数. </p>
<p>X-SMTPAPI 是一个 JSON 格式的字符串, 里面包含邮件处理方式的参数. 具体用法见下: </p>
<p><strong><code>to</code> 含有收件人地址的数组</strong>. </p>
<pre><code>    {
        &quot;to&quot;: [&quot;ben@ifaxin.com&quot;, &quot;joe@ifaxin.com&quot;]
    }
</code></pre>

<p><strong>注意</strong>:</p>
<ul>
<li>X-SMTPAPI 里的 <code>to</code> 会覆盖收件人参数 <code>to</code></li>
<li>X-SMTPAPI 中的 <code>to</code> 的收件人个数不能超过100</li>
</ul>
<p><strong><code>sub</code> 是一个<a href="http://baike.baidu.com/view/1654988.htm">关联数组</a>. </strong>它的 <code>key</code> 是「变量」, <code>value</code> 是「替换值数组」.</p>
<p>用法解释: 每一个「变量」对应一个「替换值数组」, 在做邮件内容替换时, 每一个「收件人」按其在「收件人数组」中出现的位置使用「替换值数组」中相应位置的值来替换「变量」的值.</p>
<p>相信你一定没看懂上面的饶口令, 所以, 请参见如下示例: </p>
<pre><code># 邮件内容
亲爱的%name%:

    您好! 您本月在爱发信的消费金额为: %money% 元.

#---------------------------------------------------

# X-SMTPAPI
{
    &quot;to&quot;: [&quot;ben@ifaxin.com&quot;, &quot;joe@ifaxin.com&quot;],
    &quot;sub&quot;:
    {
        &quot;%name%&quot;: [&quot;Ben&quot;, &quot;Joe&quot;],
        &quot;%money%&quot;:[288, 497]
    }
}

#---------------------------------------------------

# ben@ifaxin.com 收到的邮件:
亲爱的Ben:

    您好! 您本月在爱发信的消费金额为: 288 元.

#---------------------------------------------------

# joe@ifaxin.com 收到的邮件:
亲爱的Joe:

    您好! 您本月在爱发信的消费金额为: 497 元.
</code></pre>

<p><strong><code>section</code> 是变量的变量.</strong> 你可以在变量中使用 <code>section</code> 的变量, 用以简化很多收件人共有的替换内容.  </p>
<pre><code># 邮件内容
亲爱的%name%:

    您好! 您本月在爱发信的消费金额为: %money% 元.

    感谢%role%用户: %role_words%.

#---------------------------------------------------

# X-SMTPAPI
{
    &quot;to&quot;: [&quot;ben@ifaxin.com&quot;, &quot;joe@ifaxin.com&quot;, &quot;bida@ifaxin.com&quot;],
    &quot;sub&quot;:
    {
        &quot;%name%&quot;: [&quot;Ben&quot;, &quot;Joe&quot;, &quot;Liubida&quot;],
        &quot;%money%&quot;:[288, 497, 688], 
        &quot;%role%&quot;:[&quot;银牌&quot;, &quot;金牌&quot;, &quot;金牌&quot;]
        &quot;%role_words%&quot;:[&quot;%silver%&quot;, &quot;%golden%&quot;, &quot;%golden%&quot;]
    },
    &quot;section&quot;:
    {
        &quot;silver&quot;: &quot;some words written to silver user, maybe it is verrrrrrrrry long&quot;,
        &quot;golden&quot;: &quot;some words written to golden user, maybe it is verrrrrrrrry long, too&quot;,
    }
}

#---------------------------------------------------

# ben@ifaxin.com 收到的邮件:
亲爱的Ben:

    您好! 您本月在爱发信的消费金额为: 288 元.

    感谢银牌用户: some words written to silver user, maybe it is verrrrrrrrry long.

#---------------------------------------------------

# joe@ifaxin.com 收到的邮件:
亲爱的Joe:

    您好! 您本月在爱发信的消费金额为: 497 元.

    感谢金牌用户: some words written to golden user, maybe it is verrrrrrrrry long, too.

#---------------------------------------------------

# bida@ifaxin.com 收到的邮件:
亲爱的Liubida:

    您好! 您本月在爱发信的消费金额为: 688 元.

    感谢金牌用户: some words written to golden user, maybe it is verrrrrrrrry long, too.
</code></pre>

<p><strong><code>apps</code> 是包含了一组应用名和它们设置的关联数组.</strong> 这些设置会覆盖它们在用户账户中的设置. </p>
<pre><code>{
   &quot;......&quot;,
   &quot;filters&quot;: {
        &quot;subscription_tracking&quot;: { # 退订追踪
            &quot;settings&quot;: { &quot;enable&quot;: &quot;1&quot; }
        },
        &quot;open_tracking&quot;: { # 打开追踪
            &quot;settings&quot;: { &quot;enable&quot;: &quot;1&quot; }
        },
        &quot;click_tracking&quot;: { # 点击追踪
            &quot;settings&quot;: { &quot;enable&quot;: &quot;1&quot; }
        }
    }
}
</code></pre>
            <div class="ds-thread" data-thread-key="规则" data-title="规则" data-url=""></div>
        </div>
        
    </div>
    <footer class="clearfix footer">
        <div class="container">
            <ul class="list-unstyled list-inline pull-left">
                <li><a href="http://sendcloud.sohu.com/aboutUs.html">关于我们</a> </li>
                <li><a href="http://sendcloud.sohu.com/aboutUs.html#agreement">服务协议</a></li>
                <li><a href="http://sendcloud.sohu.com/aboutUs.html#partners">合作伙伴</a></li>
                <li><a href="https://sendcloud.kf5.com/" target="_blank">帮助中心</a></li>
            </ul>
            <p class="pull-right">copyright 2015 &copy; SendCloud</p>
        </div>
    </footer>
    
    <script src="../js/jquery-1.11.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/prettify-1.0.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/base.js"></script>
    <script type="text/javascript">
    $('.ds-thread').attr('data-url', location.href).attr('data-thread-key', location.href)

    var duoshuoQuery = {
        short_name: "sendcloud"
    };
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';
        ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    </body>

</html>